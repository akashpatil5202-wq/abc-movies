<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ABC Movies - Akash Edition</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#e50914">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/5977/5977590.png">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root { --netflix-red: #e50914; --bg: #000; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: var(--bg); color: white; font-family: 'Helvetica Neue', sans-serif; overflow-x: hidden; }
        
        /* Splash Intro */
        #app-loader { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 10000; display: flex; align-items: center; justify-content: center; }
        .logo-text { color: var(--netflix-red); font-size: 4rem; font-weight: 900; animation: netflix-intro 2.2s ease-in-out forwards; }
        @keyframes netflix-intro { 0% { transform: scale(0.5); opacity: 0; } 40% { transform: scale(1.1); opacity: 1; } 100% { transform: scale(12); opacity: 0; } }

        /* Header with Fast Search */
        header { position: fixed; top: 0; width: 100%; z-index: 1000; background: linear-gradient(to bottom, rgba(0,0,0,1), transparent); padding: 12px 15px; display: flex; align-items: center; box-sizing: border-box; }
        .search-container { flex-grow: 1; margin-left: 15px; }
        .search-container input { width: 100%; padding: 8px 15px; background: #222; border: none; color: white; border-radius: 20px; font-size: 0.85rem; outline: none; }

        /* Tabs */
        .tabs { display: flex; gap: 10px; padding: 75px 15px 10px; overflow-x: auto; scrollbar-width: none; background: #000; position: sticky; top: 0; z-index: 999; }
        .tabs::-webkit-scrollbar { display: none; }
        .tab { padding: 6px 15px; border: 1px solid #444; border-radius: 20px; font-size: 0.75rem; white-space: nowrap; color: #ccc; }
        .tab.active { background: white; color: black; border: none; font-weight: bold; }

        /* Movie Grid */
        .movie-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; padding: 10px 10px 100px; }
        .m-card { position: relative; border-radius: 4px; overflow: hidden; background: #111; border: 0.5px solid #222; }
        .m-card img { width: 100%; aspect-ratio: 2/3; object-fit: cover; }
        .m-info { padding: 5px; background: #111; text-align: center; }
        .m-name { font-size: 0.65rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; margin-bottom: 4px; }
        .download-btn { font-size: 0.6rem; color: #00dfa2; text-decoration: none; display: block; }

        .rating-tag { position: absolute; top: 5px; right: 5px; background: rgba(0,0,0,0.7); color: #ffc107; font-size: 0.55rem; padding: 2px 4px; border-radius: 3px; font-weight: bold; }
        .m-tag { position: absolute; top: 5px; left: 5px; background: var(--netflix-red); font-size: 0.5rem; padding: 2px 4px; border-radius: 2px; font-weight: bold; }

        /* Nav */
        nav { position: fixed; bottom: 0; width: 100%; height: 60px; background: rgba(18,18,18,0.95); backdrop-filter: blur(10px); display: flex; justify-content: space-around; align-items: center; border-top: 1px solid #333; z-index: 2000; }
        .nav-link { color: #757575; text-align: center; font-size: 0.6rem; flex: 1; }
        .nav-link.active { color: white; }

        /* Panels */
        .panel { display: none; }
        .active-panel { display: block; }
        #player { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 5000; display: none; }
        video { width: 100%; height: 100%; }
        input, select { width: 100%; padding: 12px; margin-bottom: 10px; background: #333; border: none; color: white; border-radius: 4px; box-sizing: border-box; }
    </style>
</head>
<body>

    <div id="app-loader"><div class="logo-text">ABC</div></div>

    <header>
        <span style="color:var(--netflix-red); font-weight:900; font-size: 1.5rem;">ABC</span>
        <div class="search-container">
            <input type="text" id="movieSearch" placeholder="Search Movies..." oninput="render(this.value)">
        </div>
    </header>

    <main>
        <div id="home-view" class="panel active-panel">
            <div class="tabs">
                <div class="tab active" onclick="setIndustry('All', this)">All</div>
                <div class="tab" onclick="setIndustry('Bollywood', this)">Bollywood</div>
                <div class="tab" onclick="setIndustry('Hollywood', this)">Hollywood</div>
                <div class="tab" onclick="setIndustry('South Indian', this)">South Indian</div>
            </div>
            <div id="movie-grid" class="movie-grid"></div>
        </div>

        <div id="admin-view" class="panel" style="padding:100px 20px;">
            <div style="background:#1a1a1a; padding:15px; border-radius:8px;">
                <h3 style="color:var(--netflix-red)">Admin Upload</h3>
                <input type="text" id="m-name" placeholder="Title">
                <select id="m-ind">
                    <option value="Bollywood">Bollywood</option>
                    <option value="Hollywood">Hollywood</option>
                    <option value="South Indian">South Indian</option>
                </select>
                <select id="m-rate">
                    <option value="9.5">⭐ 9.5</option>
                    <option value="8.5">⭐ 8.5</option>
                    <option value="7.5">⭐ 7.5</option>
                </select>
                <input type="file" id="m-pos" accept="image/*">
                <input type="file" id="m-vid" accept="video/*">
                <button onclick="upload()" style="width:100%; padding:15px; background:var(--netflix-red); border:none; color:white; font-weight:bold; border-radius:4px;">ADD MOVIE</button>
            </div>
            <div id="admin-list" style="margin-top:20px;"></div>
        </div>
    </main>

    <nav>
        <div class="nav-link active" onclick="showPanel('home')"><i class="fas fa-home"></i><br>Home</div>
        <div class="nav-link" onclick="openAdmin()"><i class="fas fa-user-shield"></i><br>Admin</div>
        <div class="nav-link" onclick="location.reload()"><i class="fas fa-redo"></i><br>Refresh</div>
    </nav>

    <div id="player">
        <i class="fas fa-arrow-left" onclick="closeV()" style="position:absolute; top:20px; left:20px; z-index:5001; background:rgba(0,0,0,0.5); padding:10px; border-radius:50%;"></i>
        <video id="vid" controls></video>
    </div>

    <script>
        // Service Worker Registration for PWA
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js').catch(err => console.log("SW error", err));
        }

        let db; let currentInd = 'All';
        const ADMIN_PASS = "Akash$2009";

        const req = indexedDB.open("ABCAppDB", 1);
        req.onupgradeneeded = e => { db = e.target.result; db.createObjectStore("movies", {keyPath: "id"}); };
        req.onsuccess = e => { db = e.target.result; render(); setTimeout(() => document.getElementById('app-loader').style.display = 'none', 2200); };

        function render(query = "") {
            const grid = document.getElementById('movie-grid');
            const alist = document.getElementById('admin-list');
            db.transaction("movies").objectStore("movies").getAll().onsuccess = e => {
                let list = e.target.result;
                let filtered = list.filter(m => (currentInd === 'All' || m.industry === currentInd) && m.name.toLowerCase().includes(query.toLowerCase()));

                grid.innerHTML = filtered.length ? filtered.map(m => {
                    const videoUrl = URL.createObjectURL(m.video);
                    return `
                    <div class="m-card">
                        <div class="m-tag">${m.industry.split(' ')[0]}</div>
                        <img src="${m.poster}" onclick="playV(${m.id})">
                        <div class="rating-tag">⭐ ${m.rating}</div>
                        <div class="m-info">
                            <div class="m-name">${m.name}</div>
                            <a href="${videoUrl}" download="${m.name}.mp4" class="download-btn"><i class="fas fa-download"></i> Save</a>
                        </div>
                    </div>`;
                }).join('') : `<div style="grid-column:1/4;text-align:center;padding:50px;color:#555">Nothing found...</div>`;

                alist.innerHTML = list.map(m => `<div style="padding:10px; background:#222; margin-bottom:5px;">${m.name} <i class="fas fa-trash" onclick="del(${m.id})" style="color:red; float:right"></i></div>`).join('');
            };
        }

        function upload() {
            const name = document.getElementById('m-name').value;
            const ind = document.getElementById('m-ind').value;
            const rate = document.getElementById('m-rate').value;
            const p = document.getElementById('m-pos').files[0];
            const v = document.getElementById('m-vid').files[0];
            if(!name || !p || !v) return alert("Fill all fields!");
            const reader = new FileReader();
            reader.onload = e => {
                db.transaction("movies", "readwrite").objectStore("movies").add({ id: Date.now(), name, industry: ind, rating: rate, poster: e.target.result, video: v });
                render(); showPanel('home');
            };
            reader.readAsDataURL(p);
        }

        function playV(id) {
            db.transaction("movies").objectStore("movies").get(id).onsuccess = e => {
                const v = document.getElementById('vid');
                v.src = URL.createObjectURL(e.target.result.video);
                document.getElementById('player').style.display = "block";
                v.play();
            };
        }

        function openAdmin() { if(prompt("Pass:") === ADMIN_PASS) showPanel('admin'); else alert("Wrong!"); }
        function showPanel(p) { document.querySelectorAll('.panel').forEach(v => v.classList.remove('active-panel')); document.getElementById(p + '-view').classList.add('active-panel'); }
        function closeV() { document.getElementById('player').style.display = "none"; document.getElementById('vid').src = ""; }
        function del(id) { if(confirm("Delete?")) db.transaction("movies", "readwrite").objectStore("movies").delete(id).oncomplete = render; }
        function setIndustry(ind, btn) {
            currentInd = ind;
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            btn.classList.add('active');
            render(document.getElementById('movieSearch').value);
        }
    </script>
</body>
</html>